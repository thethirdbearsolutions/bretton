<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bretton Woods - Multi-Room Lobby</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .room-lobby {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .room-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 16px;
            border: 2px solid #e2e8f0;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .room-card:hover {
            border-color: #3b82f6;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.1);
        }
        
        .room-card.full {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .room-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .room-name {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1e293b;
        }
        
        .room-status {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 600;
        }
        
        .room-status.waiting {
            background: #fef3c7;
            color: #d97706;
        }
        
        .room-status.playing {
            background: #dcfce7;
            color: #16a34a;
        }
        
        .room-status.complete {
            background: #e0e7ff;
            color: #4f46e5;
        }
        
        .room-info {
            display: flex;
            gap: 20px;
            color: #64748b;
            font-size: 0.875rem;
            margin-bottom: 12px;
        }
        
        .room-actions {
            display: flex;
            gap: 12px;
        }
        
        .btn-create-room {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-create-room:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(59, 130, 246, 0.3);
        }
        
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .modal {
            background: white;
            border-radius: 16px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }
        
        .modal-header {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 20px;
            color: #1e293b;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #475569;
        }
        
        .form-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3b82f6;
        }
        
        .modal-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }
        
        .breadcrumb {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 20px;
            color: #64748b;
            font-size: 0.875rem;
        }
        
        .breadcrumb button {
            background: none;
            border: none;
            color: #3b82f6;
            cursor: pointer;
            text-decoration: underline;
            padding: 0;
            font-size: 0.875rem;
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #94a3b8;
        }
        
        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 16px;
        }
    </style>
</head>
<body>
    <div id="root">
        <div class="container">
            <div class="card">
                <div style="text-align: center; padding: 40px;">
                    <div style="font-size: 3rem; margin-bottom: 20px;">‚è≥</div>
                    <h2>Loading Bretton Woods...</h2>
                    <p style="color: #64748b; margin-top: 10px;">
                        Connecting to server and loading game data
                    </p>
                    <div style="margin-top: 20px;">
                        <div style="width: 100%; height: 4px; background: #e2e8f0; border-radius: 2px; overflow: hidden;">
                            <div style="width: 30%; height: 100%; background: #3b82f6; animation: loading 1.5s ease-in-out infinite;">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <style>
        @keyframes loading {
            0% { transform: translateX(-100%); }
            50% { transform: translateX(300%); }
            100% { transform: translateX(-100%); }
        }
    </style>
    
    <script src="/socket.io/socket.io.js"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script type="text/babel">
        let gameData = null;
        let loadAttempts = 0;
        const MAX_ATTEMPTS = 3;
        
        function loadGameData() {
          console.log('Loading game data... (attempt ' + (loadAttempts + 1) + ')');
          
          fetch('/game-data.json')
            .then(r => {
              if (!r.ok) {
                throw new Error('Failed to load game data: ' + r.status);
              }
              return r.json();
            })
            .then(data => {
              console.log('Game data loaded successfully!');
              gameData = data;
              initializeApp();
            })
            .catch(err => {
              console.error('Error loading game data:', err);
              loadAttempts++;
              
              if (loadAttempts < MAX_ATTEMPTS) {
                console.log('Retrying in 2 seconds...');
                setTimeout(loadGameData, 2000);
              } else {
                console.error('Failed to load game data after ' + MAX_ATTEMPTS + ' attempts');
                document.getElementById('root').innerHTML = `
                  <div class="container">
                    <div class="card">
                      <h2 style="color: #dc2626;">‚ùå Error Loading Game</h2>
                      <p>Could not load game-data.json. Please check:</p>
                      <ul style="text-align: left; margin: 20px 0;">
                        <li>Server is running properly</li>
                        <li>game-data.json file exists</li>
                        <li>File is valid JSON</li>
                      </ul>
                      <button onclick="location.reload()" class="btn-primary">
                        Retry
                      </button>
                    </div>
                  </div>
                `;
              }
            });
        }
        
        // Start loading
        loadGameData();

        const socket = io();
        const { useState, useEffect } = React;

        const BrettonWoodsMultiRoom = () => {
          // Authentication state
          const [isAuthenticated, setIsAuthenticated] = useState(false);
          const [username, setUsername] = useState('');
          const [playerId, setPlayerId] = useState('');
          const [userRole, setUserRole] = useState('player');
          const [showRegister, setShowRegister] = useState(false);
          
          // Room state
          const [currentView, setCurrentView] = useState('roomLobby'); // 'roomLobby' or 'gameRoom'
          const [roomList, setRoomList] = useState([]);
          const [currentRoom, setCurrentRoom] = useState(null);
          const [showCreateRoomModal, setShowCreateRoomModal] = useState(false);
          
          // Game state
          const [playerCountry, setPlayerCountry] = useState(null);
          const [gameState, setGameState] = useState(null);
          const [isReady, setIsReady] = useState(false);
          const [connected, setConnected] = useState(false);

          // Check for existing session
          useEffect(() => {
            const savedUsername = sessionStorage.getItem('brettonWoodsUsername');
            const savedPlayerId = sessionStorage.getItem('brettonWoodsPlayerId');
            const savedUserRole = sessionStorage.getItem('brettonWoodsUserRole');
            
            if (savedUsername && savedPlayerId) {
              setUsername(savedUsername);
              setPlayerId(savedPlayerId);
              setUserRole(savedUserRole || 'player');
              setIsAuthenticated(true);
            }
          }, []);

          // Socket connection
          useEffect(() => {
            socket.on('connect', () => {
              setConnected(true);
              console.log('Connected to server');
            });

            socket.on('disconnect', () => {
              setConnected(false);
              console.log('Disconnected from server');
            });

            socket.on('roomListUpdate', (list) => {
              setRoomList(list);
            });

            socket.on('stateUpdate', (state) => {
              console.log('=== STATE UPDATE ===');
              console.log('Game started:', state.gameStarted);
              console.log('Game phase:', state.gamePhase);
              console.log('Current round:', state.currentRound);
              console.log('Players:', Object.keys(state.players).length);
              
              setGameState(state);
              
              // Check if we're in this room
              if (state.players[playerId]) {
                setPlayerCountry(state.players[playerId].country);
                setIsReady(state.readyPlayers.includes(playerId));
              }
              
              console.log('State updated in React');
            });

            socket.on('roomCreated', ({ roomId, roomName }) => {
              setCurrentRoom({ id: roomId, name: roomName });
              setCurrentView('gameRoom');
              socket.emit('joinRoom', { roomId });
            });

            socket.on('joinRoomResult', ({ success, roomId, message }) => {
              if (success) {
                console.log('Joined room:', roomId);
              } else {
                alert(message || 'Failed to join room');
              }
            });

            socket.on('leftRoom', () => {
              setCurrentView('roomLobby');
              setCurrentRoom(null);
              setPlayerCountry(null);
              setIsReady(false);
            });

            socket.on('roomDeleted', () => {
              alert('This room has been deleted by the host');
              setCurrentView('roomLobby');
              setCurrentRoom(null);
              setPlayerCountry(null);
              setIsReady(false);
            });
            
            socket.on('startGameResult', ({ success, message }) => {
              if (!success) {
                alert(message || 'Failed to start game');
              } else {
                console.log('Game started successfully');
              }
            });
            
            socket.on('resetRoomResult', ({ success, message }) => {
              if (!success) {
                alert(message || 'Failed to reset room');
              } else {
                console.log('Room reset successfully');
              }
            });
            
            socket.on('joinResult', ({ success, message }) => {
              if (!success) {
                alert(message || 'Failed to join game');
              }
            });

            return () => {
              socket.off('connect');
              socket.off('disconnect');
              socket.off('roomListUpdate');
              socket.off('stateUpdate');
              socket.off('roomCreated');
              socket.off('joinRoomResult');
              socket.off('leftRoom');
              socket.off('roomDeleted');
              socket.off('startGameResult');
              socket.off('resetRoomResult');
              socket.off('joinResult');
            };
          }, [playerId]);

          // Authentication handlers
          const handleRegister = (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const username = formData.get('username');
            const password = formData.get('password');

            socket.emit('register', { username, password });
            
            socket.once('registerResult', ({ success, playerId: newPlayerId, role, message }) => {
              if (success) {
                setUsername(username);
                setPlayerId(newPlayerId);
                setUserRole(role || 'player');
                setIsAuthenticated(true);
                sessionStorage.setItem('brettonWoodsUsername', username);
                sessionStorage.setItem('brettonWoodsPlayerId', newPlayerId);
                sessionStorage.setItem('brettonWoodsUserRole', role || 'player');
                
                if (role === 'superadmin') {
                  alert('üéâ Welcome, Administrator! You have full control over the site.');
                }
              } else {
                alert(message);
              }
            });
          };

          const handleLogin = (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const username = formData.get('username');
            const password = formData.get('password');

            socket.emit('login', { username, password });
            
            socket.once('loginResult', ({ success, playerId: returnedPlayerId, role, message }) => {
              console.log('=== LOGIN RESULT ===');
              console.log('Success:', success);
              console.log('Role received:', role);
              console.log('Player ID:', returnedPlayerId);
              
              if (success) {
                setUsername(username);
                setPlayerId(returnedPlayerId);
                setUserRole(role || 'player');
                setIsAuthenticated(true);
                sessionStorage.setItem('brettonWoodsUsername', username);
                sessionStorage.setItem('brettonWoodsPlayerId', returnedPlayerId);
                sessionStorage.setItem('brettonWoodsUserRole', role || 'player');
                
                console.log('Stored in session:', {
                  username: sessionStorage.getItem('brettonWoodsUsername'),
                  playerId: sessionStorage.getItem('brettonWoodsPlayerId'),
                  role: sessionStorage.getItem('brettonWoodsUserRole')
                });
                console.log('===================');
              } else {
                console.log('Login failed:', message);
                alert(message || 'Login failed. If you recently registered but the server restarted, you may need to register again or click "Clear Saved Session" to start fresh.');
              }
            });
          };

          const handleClearSession = () => {
            sessionStorage.clear();
            localStorage.clear();
            window.location.reload();
          };

          // Room handlers
          const handleCreateRoom = (roomName) => {
            socket.emit('createRoom', { playerId, roomName });
            setShowCreateRoomModal(false);
          };

          const handleJoinRoom = (roomId, roomName) => {
            setCurrentRoom({ id: roomId, name: roomName });
            setCurrentView('gameRoom');
            socket.emit('joinRoom', { roomId });
          };

          const handleLeaveRoom = () => {
            if (currentRoom) {
              socket.emit('leaveRoom', { roomId: currentRoom.id });
              socket.emit('leaveGame', { roomId: currentRoom.id, playerId });
            }
          };

          const handleDeleteRoom = () => {
            if (currentRoom && window.confirm('Are you sure you want to delete this room?')) {
              socket.emit('deleteRoom', { roomId: currentRoom.id, playerId });
            }
          };

          // Game handlers
          const handleJoinGame = (country) => {
            if (userRole === 'superadmin') {
              alert('As administrator, you are an observer and cannot select a country.');
              return;
            }
            
            if (currentRoom) {
              socket.emit('joinGame', { roomId: currentRoom.id, playerId, country });
            }
          };

          const handleLeaveGame = () => {
            if (currentRoom) {
              socket.emit('leaveGame', { roomId: currentRoom.id, playerId });
              setPlayerCountry(null);
              setIsReady(false);
            }
          };

          const handleReady = () => {
            if (currentRoom) {
              socket.emit('setReady', { roomId: currentRoom.id, playerId, ready: !isReady });
            }
          };

          // Get countries and issues from game data
          const countries = gameData?.countries || {};
          const issues = gameData?.issues || [];
          const currentIssue = gameState?.currentRound ? issues[gameState.currentRound - 1] : null;

          // Login screen
          if (!isAuthenticated) {
            return (
              <div className="container">
                <div className="header">
                  <h1>üåç Bretton Woods 1944</h1>
                  <p>Multi-Room Multiplayer Simulation</p>
                </div>

                <div className="card">
                  <h2>{showRegister ? 'Create Account' : 'Login'}</h2>
                  
                  <form onSubmit={showRegister ? handleRegister : handleLogin}>
                    <div style={{ marginBottom: '16px' }}>
                      <label style={{ display: 'block', marginBottom: '8px', fontWeight: 'bold' }}>
                        Username
                      </label>
                      <input
                        type="text"
                        name="username"
                        required
                        style={{
                          width: '100%',
                          padding: '12px',
                          border: '2px solid #e2e8f0',
                          borderRadius: '6px',
                          fontSize: '1rem'
                        }}
                      />
                    </div>

                    <div style={{ marginBottom: '20px' }}>
                      <label style={{ display: 'block', marginBottom: '8px', fontWeight: 'bold' }}>
                        Password
                      </label>
                      <input
                        type="password"
                        name="password"
                        required
                        style={{
                          width: '100%',
                          padding: '12px',
                          border: '2px solid #e2e8f0',
                          borderRadius: '6px',
                          fontSize: '1rem'
                        }}
                      />
                    </div>

                    <button type="submit" className="btn-primary" style={{ width: '100%' }}>
                      {showRegister ? 'Register' : 'Login'}
                    </button>
                  </form>

                  <div style={{ marginTop: '16px', textAlign: 'center' }}>
                    <button
                      onClick={() => setShowRegister(!showRegister)}
                      style={{
                        background: 'none',
                        border: 'none',
                        color: '#3b82f6',
                        cursor: 'pointer',
                        textDecoration: 'underline'
                      }}
                    >
                      {showRegister ? 'Already have an account? Login' : "Don't have an account? Register"}
                    </button>
                  </div>

                  {(sessionStorage.getItem('brettonWoodsUsername') || 
                    sessionStorage.getItem('brettonWoodsPlayerId')) && (
                    <div style={{ marginTop: '16px', textAlign: 'center' }}>
                      <button
                        onClick={handleClearSession}
                        style={{
                          background: 'none',
                          border: 'none',
                          color: '#dc2626',
                          cursor: 'pointer',
                          fontSize: '0.875rem'
                        }}
                      >
                        üóëÔ∏è Clear Saved Session
                      </button>
                      <p style={{ 
                        fontSize: '0.75rem', 
                        color: '#64748b', 
                        marginTop: '8px' 
                      }}>
                        Use this if you're having login issues
                      </p>
                    </div>
                  )}
                </div>
              </div>
            );
          }

          // Room Lobby
          if (currentView === 'roomLobby') {
            return (
              <div className="room-lobby">
                <div className="header">
                  <h1>üåç Bretton Woods - Game Rooms</h1>
                  <p>
                    Welcome, {username}! üë§
                    {userRole === 'superadmin' && (
                      <span style={{
                        marginLeft: '10px',
                        padding: '4px 12px',
                        background: 'linear-gradient(135deg, #dc2626 0%, #b91c1c 100%)',
                        color: 'white',
                        borderRadius: '12px',
                        fontSize: '0.75rem',
                        fontWeight: 'bold',
                        boxShadow: '0 2px 4px rgba(220, 38, 38, 0.3)'
                      }}>
                        üõ°Ô∏è ADMINISTRATOR
                      </span>
                    )}
                  </p>
                </div>

                <div style={{ 
                  position: 'fixed', 
                  top: '10px', 
                  right: '10px', 
                  padding: '8px 16px',
                  background: connected ? '#dcfce7' : '#fee2e2',
                  color: connected ? '#166534' : '#991b1b',
                  borderRadius: '6px',
                  fontSize: '0.875rem',
                  fontWeight: '600',
                  zIndex: 1000
                }}>
                  {connected ? 'üü¢ Connected' : 'üî¥ Disconnected'}
                </div>

                <div className="card">
                  <h2 style={{ marginBottom: '20px' }}>Available Rooms</h2>
                  
                  {roomList.length === 0 ? (
                    <div className="empty-state">
                      <div className="empty-state-icon">üè†</div>
                      <h3>No rooms available</h3>
                      <p>Create a new room to get started!</p>
                    </div>
                  ) : (
                    roomList.map((room) => (
                      <div 
                        key={room.id} 
                        className={`room-card ${room.playerCount >= room.maxPlayers ? 'full' : ''}`}
                        onClick={() => room.playerCount < room.maxPlayers && handleJoinRoom(room.id, room.name)}
                      >
                        <div className="room-header">
                          <div className="room-name">{room.name}</div>
                          <div className={`room-status ${room.status}`}>
                            {room.status === 'waiting' && '‚è∏Ô∏è Waiting'}
                            {room.status === 'playing' && '‚ñ∂Ô∏è Playing'}
                            {room.status === 'complete' && '‚úì Complete'}
                          </div>
                        </div>
                        
                        <div className="room-info">
                          <span>üë• {room.playerCount}/{room.maxPlayers} players</span>
                          <span>üéÆ Phase: {room.phase}</span>
                          <span>‚è∞ {new Date(room.createdAt).toLocaleTimeString()}</span>
                        </div>
                        
                        {room.playerCount >= room.maxPlayers && (
                          <div style={{ color: '#dc2626', fontSize: '0.875rem', fontWeight: '600' }}>
                            Room Full
                          </div>
                        )}
                      </div>
                    ))
                  )}
                </div>

                {userRole === 'superadmin' && (
                  <div className="card" style={{ 
                    marginTop: '20px', 
                    background: 'linear-gradient(135deg, #fee2e2 0%, #fecaca 100%)',
                    border: '2px solid #dc2626'
                  }}>
                    <h3 style={{ margin: '0 0 15px 0', color: '#7f1d1d' }}>
                      üõ°Ô∏è Administrator Panel
                    </h3>
                    <div style={{ display: 'flex', gap: '10px', flexWrap: 'wrap' }}>
                      <button
                        onClick={() => {
                          if (window.confirm('Clear all data?\n\nThis will delete:\n‚Ä¢ All rooms\n‚Ä¢ All user accounts (except administrator)\n‚Ä¢ All game progress\n\nType CLEAR_ALL_DATA in the next prompt to confirm.')) {
                            const confirmCode = prompt('Type CLEAR_ALL_DATA to confirm:');
                            if (confirmCode === 'CLEAR_ALL_DATA') {
                              socket.emit('clearAllData', { playerId, confirmCode });
                              socket.once('clearDataResult', ({ success, message }) => {
                                alert(message);
                                if (success) {
                                  window.location.reload();
                                }
                              });
                            }
                          }
                        }}
                        style={{
                          padding: '10px 16px',
                          background: '#dc2626',
                          color: 'white',
                          border: 'none',
                          borderRadius: '6px',
                          cursor: 'pointer',
                          fontWeight: '600'
                        }}
                      >
                        üóëÔ∏è Clear All Data
                      </button>
                    </div>
                    <p style={{ 
                      marginTop: '15px', 
                      fontSize: '0.875rem', 
                      color: '#7f1d1d',
                      fontStyle: 'italic'
                    }}>
                      Only you (jjucovy@gmail.com) can create and manage rooms.
                    </p>
                  </div>
                )}

                {userRole === 'superadmin' && (
                  <>
                    <button 
                      className="btn-create-room"
                      onClick={() => setShowCreateRoomModal(true)}
                      style={{ marginTop: '20px' }}
                    >
                      + Create New Room
                    </button>

                    {showCreateRoomModal && (
                      <CreateRoomModal
                        onClose={() => setShowCreateRoomModal(false)}
                        onCreate={handleCreateRoom}
                      />
                    )}
                  </>
                )}
                
                {userRole !== 'superadmin' && (
                  <div className="card" style={{ 
                    marginTop: '20px',
                    background: '#f8fafc',
                    border: '2px solid #cbd5e1',
                    textAlign: 'center',
                    padding: '30px'
                  }}>
                    <div style={{ fontSize: '3rem', marginBottom: '15px' }}>üîí</div>
                    <h3 style={{ color: '#475569', marginBottom: '10px' }}>Room Creation Restricted</h3>
                    <p style={{ color: '#64748b', margin: 0 }}>
                      Only the site administrator can create new rooms.
                    </p>
                  </div>
                )}
              </div>
            );
          }

          // Game Room
          if (currentView === 'gameRoom' && currentRoom) {
            const isHost = gameState?.hostId === playerId;
            const playerList = gameState?.players ? Object.values(gameState.players) : [];
            const availableCountries = Object.keys(countries).filter(
              country => !playerList.some(p => p.country === country)
            );

            return (
              <div className="container">
                {userRole === 'superadmin' && (
                  <div className="breadcrumb">
                    <button onClick={handleLeaveRoom}>‚Üê Back to Lobby</button>
                    <span>/</span>
                    <span>{currentRoom.name}</span>
                  </div>
                )}

                <div style={{ 
                  position: 'fixed', 
                  top: '10px', 
                  right: '10px', 
                  padding: '8px 16px',
                  background: connected ? '#dcfce7' : '#fee2e2',
                  color: connected ? '#166534' : '#991b1b',
                  borderRadius: '6px',
                  fontSize: '0.875rem',
                  fontWeight: '600',
                  zIndex: 1000
                }}>
                  {connected ? 'üü¢ Connected' : 'üî¥ Disconnected'}
                </div>

                <div className="header">
                  <h1>üè† {currentRoom.name}</h1>
                  <p style={{ marginTop: '8px', fontSize: '0.875rem', color: '#64748b' }}>
                    {userRole === 'superadmin' && 'üõ°Ô∏è Administrator | '}
                    Room ID: {currentRoom.id}
                  </p>
                </div>

                <div className="card">
                  <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '20px', flexWrap: 'wrap', gap: '10px' }}>
                    <h2>{gameState?.gameStarted ? 'Game In Progress' : 'Game Lobby'}</h2>
                    {userRole === 'superadmin' && (
                      <div style={{ display: 'flex', gap: '10px' }}>
                        {!gameState?.gameStarted && (
                          <button
                            onClick={() => {
                              console.log('Start game button clicked');
                              socket.emit('startGame', { roomId: currentRoom.id, playerId });
                            }}
                            className="btn-primary"
                            style={{ padding: '8px 16px' }}
                          >
                            üéÆ Start Game
                          </button>
                        )}
                        {gameState?.gameStarted && (
                          <button
                            onClick={() => {
                              if (window.confirm('Reset this room? All progress will be lost.')) {
                                socket.emit('resetRoom', { roomId: currentRoom.id, playerId });
                              }
                            }}
                            style={{
                              padding: '8px 16px',
                              background: '#f59e0b',
                              color: 'white',
                              border: 'none',
                              borderRadius: '6px',
                              cursor: 'pointer'
                            }}
                          >
                            üîÑ Reset Game
                          </button>
                        )}
                        <button
                          onClick={handleDeleteRoom}
                          style={{
                            padding: '8px 16px',
                            background: '#dc2626',
                            color: 'white',
                            border: 'none',
                            borderRadius: '6px',
                            cursor: 'pointer'
                          }}
                        >
                          üóëÔ∏è Delete Room
                        </button>
                      </div>
                    )}
                  </div>

                  {gameState?.gameStarted ? (
                    <div>
                      {/* DEBUG INFO */}
                      <div style={{
                        padding: '10px',
                        background: '#f0f9ff',
                        borderRadius: '6px',
                        marginBottom: '20px',
                        fontSize: '0.75rem',
                        color: '#0369a1',
                        fontFamily: 'monospace'
                      }}>
                        <strong>Debug Info:</strong> gameStarted={String(gameState.gameStarted)}, 
                        gamePhase={gameState.gamePhase}, 
                        currentRound={gameState.currentRound},
                        userRole={userRole},
                        playerCountry={playerCountry || 'none'},
                        currentIssue={currentIssue ? 'exists' : 'null'}
                      </div>

                      {/* VOTING PHASE */}
                      {gameState.gamePhase === 'voting' && (
                        <div>
                          {/* Round Header */}
                          <div style={{
                            padding: '20px',
                            background: 'linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%)',
                            borderRadius: '8px',
                            marginBottom: '20px',
                            border: '2px solid #3b82f6'
                          }}>
                            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                              <div>
                                <h2 style={{ color: '#1e40af', margin: 0, fontSize: '1.5rem' }}>
                                  Round {gameState.currentRound} of 10
                                </h2>
                                <p style={{ color: '#3b82f6', margin: '5px 0 0 0', fontSize: '0.875rem' }}>
                                  Phase 1: Conference Voting
                                </p>
                              </div>
                              <div style={{ textAlign: 'right' }}>
                                <div style={{ fontSize: '0.875rem', color: '#64748b' }}>Your Score</div>
                                <div style={{ fontSize: '1.5rem', fontWeight: 'bold', color: '#16a34a' }}>
                                  {gameState.scores?.[playerCountry] || 0} pts
                                </div>
                              </div>
                            </div>
                          </div>

                          {/* Observer View */}
                          {userRole === 'superadmin' ? (
                            <div>
                              <div style={{
                                padding: '30px',
                                background: '#fef3c7',
                                borderRadius: '8px',
                                border: '2px solid #f59e0b',
                                marginBottom: '20px'
                              }}>
                                <h3 style={{ color: '#92400e', marginTop: 0 }}>üëÅÔ∏è Observer Mode</h3>
                                <p style={{ color: '#78350f' }}>
                                  You are monitoring the game. Players are voting on issues.
                                </p>
                              </div>

                              {/* Show current issue */}
                              {currentIssue && (
                                <div className="card" style={{ marginBottom: '20px' }}>
                                  <h3 style={{ marginTop: 0, color: '#1e293b' }}>{currentIssue.title}</h3>
                                  <p style={{ color: '#64748b', fontSize: '0.95rem' }}>
                                    {currentIssue.description}
                                  </p>
                                  
                                  <div style={{ marginTop: '20px' }}>
                                    <h4 style={{ fontSize: '0.9rem', color: '#64748b', marginBottom: '10px' }}>
                                      Voting Progress:
                                    </h4>
                                    <div style={{ 
                                      display: 'grid', 
                                      gap: '8px'
                                    }}>
                                      {playerList.map((player) => (
                                        <div key={player.id} style={{
                                          padding: '10px',
                                          background: gameState.votes?.[player.id] ? '#dcfce7' : '#f8fafc',
                                          borderRadius: '6px',
                                          borderLeft: '4px solid ' + (gameState.votes?.[player.id] ? '#16a34a' : '#cbd5e1')
                                        }}>
                                          <span style={{ fontWeight: 'bold' }}>
                                            {countries[player.country]?.name || player.country}
                                          </span>
                                          <span style={{ 
                                            marginLeft: '10px', 
                                            color: gameState.votes?.[player.id] ? '#16a34a' : '#64748b',
                                            fontSize: '0.875rem'
                                          }}>
                                            {gameState.votes?.[player.id] ? '‚úì Voted' : '‚è≥ Waiting...'}
                                          </span>
                                        </div>
                                      ))}
                                    </div>
                                  </div>
                                </div>
                              )}
                            </div>
                          ) : (
                            <div>
                              {/* Player Voting Interface */}
                              {currentIssue && (
                                <div>
                                  {/* Issue Card */}
                                  <div className="card" style={{ 
                                    marginBottom: '20px',
                                    background: 'white',
                                    border: '2px solid #e2e8f0'
                                  }}>
                                    <div style={{
                                      padding: '15px',
                                      background: '#f8fafc',
                                      borderRadius: '6px',
                                      marginBottom: '15px'
                                    }}>
                                      <h3 style={{ 
                                        margin: 0, 
                                        color: '#1e293b',
                                        fontSize: '1.25rem' 
                                      }}>
                                        {currentIssue.title}
                                      </h3>
                                    </div>
                                    
                                    <p style={{ 
                                      fontSize: '0.95rem', 
                                      lineHeight: '1.6',
                                      color: '#475569',
                                      marginBottom: '20px'
                                    }}>
                                      {currentIssue.description}
                                    </p>

                                    {/* Country-specific interests */}
                                    {currentIssue.positions && currentIssue.positions[playerCountry] && (
                                      <div style={{
                                        padding: '15px',
                                        background: '#eff6ff',
                                        borderRadius: '6px',
                                        borderLeft: '4px solid #3b82f6',
                                        marginBottom: '20px'
                                      }}>
                                        <h4 style={{ 
                                          margin: '0 0 10px 0',
                                          fontSize: '0.9rem',
                                          color: '#1e40af'
                                        }}>
                                          Your Country's Position:
                                        </h4>
                                        <p style={{ 
                                          margin: 0,
                                          fontSize: '0.875rem',
                                          color: '#1e3a8a'
                                        }}>
                                          {currentIssue.positions[playerCountry]}
                                        </p>
                                      </div>
                                    )}

                                    {/* Options */}
                                    <div style={{ marginBottom: '15px' }}>
                                      <h4 style={{ 
                                        fontSize: '0.9rem',
                                        color: '#64748b',
                                        marginBottom: '10px'
                                      }}>
                                        Options:
                                      </h4>
                                      <div style={{ display: 'grid', gap: '8px' }}>
                                        {currentIssue.options && currentIssue.options.map((option, idx) => (
                                          <div key={idx} style={{
                                            padding: '10px',
                                            background: '#f8fafc',
                                            borderRadius: '6px',
                                            fontSize: '0.875rem',
                                            color: '#475569'
                                          }}>
                                            <strong style={{ color: '#1e293b' }}>
                                              {option.label}:
                                            </strong> {option.description}
                                          </div>
                                        ))}
                                      </div>
                                    </div>
                                  </div>

                                  {/* Voting Buttons */}
                                  {!gameState.votes?.[playerId] ? (
                                    <div style={{
                                      display: 'grid',
                                      gridTemplateColumns: 'repeat(3, 1fr)',
                                      gap: '12px',
                                      marginBottom: '20px'
                                    }}>
                                      <button
                                        onClick={() => {
                                          socket.emit('vote', {
                                            roomId: currentRoom.id,
                                            playerId,
                                            choice: 'for'
                                          });
                                        }}
                                        style={{
                                          padding: '20px',
                                          background: 'linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%)',
                                          border: '2px solid #16a34a',
                                          borderRadius: '8px',
                                          cursor: 'pointer',
                                          fontSize: '1rem',
                                          fontWeight: 'bold',
                                          color: '#166534',
                                          transition: 'transform 0.2s'
                                        }}
                                        onMouseOver={(e) => e.target.style.transform = 'scale(1.05)'}
                                        onMouseOut={(e) => e.target.style.transform = 'scale(1)'}
                                      >
                                        <div style={{ fontSize: '2rem', marginBottom: '8px' }}>‚úì</div>
                                        <div>Support</div>
                                      </button>
                                      
                                      <button
                                        onClick={() => {
                                          socket.emit('vote', {
                                            roomId: currentRoom.id,
                                            playerId,
                                            choice: 'against'
                                          });
                                        }}
                                        style={{
                                          padding: '20px',
                                          background: 'linear-gradient(135deg, #fee2e2 0%, #fecaca 100%)',
                                          border: '2px solid #dc2626',
                                          borderRadius: '8px',
                                          cursor: 'pointer',
                                          fontSize: '1rem',
                                          fontWeight: 'bold',
                                          color: '#991b1b',
                                          transition: 'transform 0.2s'
                                        }}
                                        onMouseOver={(e) => e.target.style.transform = 'scale(1.05)'}
                                        onMouseOut={(e) => e.target.style.transform = 'scale(1)'}
                                      >
                                        <div style={{ fontSize: '2rem', marginBottom: '8px' }}>‚úó</div>
                                        <div>Oppose</div>
                                      </button>
                                      
                                      <button
                                        onClick={() => {
                                          socket.emit('vote', {
                                            roomId: currentRoom.id,
                                            playerId,
                                            choice: 'abstain'
                                          });
                                        }}
                                        style={{
                                          padding: '20px',
                                          background: 'linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%)',
                                          border: '2px solid #64748b',
                                          borderRadius: '8px',
                                          cursor: 'pointer',
                                          fontSize: '1rem',
                                          fontWeight: 'bold',
                                          color: '#475569',
                                          transition: 'transform 0.2s'
                                        }}
                                        onMouseOver={(e) => e.target.style.transform = 'scale(1.05)'}
                                        onMouseOut={(e) => e.target.style.transform = 'scale(1)'}
                                      >
                                        <div style={{ fontSize: '2rem', marginBottom: '8px' }}>‚óã</div>
                                        <div>Abstain</div>
                                      </button>
                                    </div>
                                  ) : (
                                    <div style={{
                                      padding: '30px',
                                      background: '#dcfce7',
                                      borderRadius: '8px',
                                      border: '2px solid #16a34a',
                                      textAlign: 'center',
                                      marginBottom: '20px'
                                    }}>
                                      <div style={{ fontSize: '3rem', marginBottom: '10px' }}>‚úì</div>
                                      <h3 style={{ color: '#166534', margin: '0 0 10px 0' }}>
                                        Vote Submitted
                                      </h3>
                                      <p style={{ color: '#14532d', margin: 0 }}>
                                        Your vote: <strong style={{ textTransform: 'capitalize' }}>
                                          {gameState.votes[playerId]}
                                        </strong>
                                      </p>
                                      <p style={{ color: '#166534', marginTop: '15px', fontSize: '0.875rem' }}>
                                        Waiting for other players to vote...
                                      </p>
                                    </div>
                                  )}
                                </div>
                              )}
                            </div>
                          )}
                        </div>
                      )}

                      {/* RESULTS PHASE */}
                      {gameState.gamePhase === 'results' && (
                        <div>
                          <div style={{
                            padding: '30px',
                            background: 'linear-gradient(135deg, #fef3c7 0%, #fde68a 100%)',
                            borderRadius: '8px',
                            border: '2px solid #f59e0b',
                            marginBottom: '20px',
                            textAlign: 'center'
                          }}>
                            <h2 style={{ color: '#92400e', marginTop: 0 }}>
                              Round {gameState.currentRound} Results
                            </h2>
                            
                            {/* Vote Outcome */}
                            <div style={{
                              padding: '20px',
                              background: gameState.roundOutcome === 'passed' ? '#dcfce7' : '#fee2e2',
                              borderRadius: '8px',
                              marginBottom: '20px'
                            }}>
                              <div style={{ fontSize: '3rem', marginBottom: '10px' }}>
                                {gameState.roundOutcome === 'passed' ? '‚úì' : '‚úó'}
                              </div>
                              <h3 style={{ 
                                color: gameState.roundOutcome === 'passed' ? '#166534' : '#991b1b',
                                margin: 0
                              }}>
                                Measure {gameState.roundOutcome === 'passed' ? 'PASSED' : 'FAILED'}
                              </h3>
                            </div>

                            {/* Vote Tally */}
                            <div style={{
                              display: 'grid',
                              gridTemplateColumns: 'repeat(3, 1fr)',
                              gap: '15px',
                              marginBottom: '20px'
                            }}>
                              <div style={{
                                padding: '15px',
                                background: 'white',
                                borderRadius: '8px'
                              }}>
                                <div style={{ fontSize: '0.875rem', color: '#64748b', marginBottom: '5px' }}>
                                  Support
                                </div>
                                <div style={{ fontSize: '2rem', fontWeight: 'bold', color: '#16a34a' }}>
                                  {gameState.voteTally?.['for'] || 0}
                                </div>
                              </div>
                              <div style={{
                                padding: '15px',
                                background: 'white',
                                borderRadius: '8px'
                              }}>
                                <div style={{ fontSize: '0.875rem', color: '#64748b', marginBottom: '5px' }}>
                                  Oppose
                                </div>
                                <div style={{ fontSize: '2rem', fontWeight: 'bold', color: '#dc2626' }}>
                                  {gameState.voteTally?.against || 0}
                                </div>
                              </div>
                              <div style={{
                                padding: '15px',
                                background: 'white',
                                borderRadius: '8px'
                              }}>
                                <div style={{ fontSize: '0.875rem', color: '#64748b', marginBottom: '5px' }}>
                                  Abstain
                                </div>
                                <div style={{ fontSize: '2rem', fontWeight: 'bold', color: '#64748b' }}>
                                  {gameState.voteTally?.abstain || 0}
                                </div>
                              </div>
                            </div>

                            {/* Your score this round */}
                            {userRole !== 'superadmin' && (
                              <div style={{
                                padding: '20px',
                                background: 'white',
                                borderRadius: '8px',
                                marginBottom: '20px'
                              }}>
                                <div style={{ fontSize: '0.875rem', color: '#64748b', marginBottom: '5px' }}>
                                  Your Score This Round
                                </div>
                                <div style={{ fontSize: '2rem', fontWeight: 'bold', color: '#3b82f6' }}>
                                  +{gameState.roundScores?.[playerCountry] || 0} pts
                                </div>
                                <div style={{ fontSize: '0.875rem', color: '#64748b', marginTop: '5px' }}>
                                  Total: {gameState.scores?.[playerCountry] || 0} pts
                                </div>
                              </div>
                            )}

                            {/* Continue button - only admin can advance */}
                            {userRole === 'superadmin' && (
                              <button
                                onClick={() => {
                                  socket.emit('advanceRound', {
                                    roomId: currentRoom.id,
                                    playerId
                                  });
                                }}
                                style={{
                                  padding: '15px 40px',
                                  background: '#3b82f6',
                                  color: 'white',
                                  border: 'none',
                                  borderRadius: '8px',
                                  fontSize: '1.1rem',
                                  fontWeight: 'bold',
                                  cursor: 'pointer'
                                }}
                              >
                                Continue to Next Round ‚Üí
                              </button>
                            )}

                            {userRole !== 'superadmin' && (
                              <p style={{ color: '#78350f', fontSize: '0.875rem', fontStyle: 'italic' }}>
                                Waiting for administrator to advance to next round...
                              </p>
                            )}
                          </div>

                          {/* Leaderboard */}
                          <div className="card">
                            <h3 style={{ marginTop: 0 }}>Current Standings</h3>
                            <div style={{ display: 'grid', gap: '10px' }}>
                              {Object.entries(gameState.scores || {})
                                .sort(([,a], [,b]) => b - a)
                                .map(([country, score], idx) => (
                                  <div key={country} style={{
                                    display: 'flex',
                                    justifyContent: 'space-between',
                                    alignItems: 'center',
                                    padding: '12px',
                                    background: country === playerCountry ? '#eff6ff' : '#f8fafc',
                                    borderRadius: '6px',
                                    borderLeft: '4px solid ' + (idx === 0 ? '#f59e0b' : '#cbd5e1')
                                  }}>
                                    <div>
                                      <span style={{ fontWeight: 'bold', marginRight: '10px' }}>
                                        {idx + 1}.
                                      </span>
                                      <span style={{ fontWeight: 'bold' }}>
                                        {countries[country]?.name || country}
                                      </span>
                                      {country === playerCountry && (
                                        <span style={{ marginLeft: '8px', fontSize: '0.875rem', color: '#3b82f6' }}>
                                          (You)
                                        </span>
                                      )}
                                    </div>
                                    <div style={{ fontWeight: 'bold', fontSize: '1.1rem' }}>
                                      {score} pts
                                    </div>
                                  </div>
                                ))}
                            </div>
                          </div>
                        </div>
                      )}

                      {/* GAME COMPLETE */}
                      {gameState.gamePhase === 'complete' && (
                        <div>
                          <div style={{
                            padding: '40px',
                            background: 'linear-gradient(135deg, #fef3c7 0%, #fde68a 100%)',
                            borderRadius: '8px',
                            border: '3px solid #f59e0b',
                            textAlign: 'center',
                            marginBottom: '20px'
                          }}>
                            <div style={{ fontSize: '4rem', marginBottom: '20px' }}>üèÜ</div>
                            <h1 style={{ color: '#92400e', marginTop: 0, marginBottom: '10px' }}>
                              Game Complete!
                            </h1>
                            <p style={{ color: '#78350f', fontSize: '1.1rem' }}>
                              Bretton Woods Conference Concluded
                            </p>
                          </div>

                          {/* Final Standings */}
                          <div className="card">
                            <h2 style={{ marginTop: 0, marginBottom: '20px' }}>Final Standings</h2>
                            <div style={{ display: 'grid', gap: '12px' }}>
                              {Object.entries(gameState.scores || {})
                                .sort(([,a], [,b]) => b - a)
                                .map(([country, score], idx) => (
                                  <div key={country} style={{
                                    display: 'flex',
                                    justifyContent: 'space-between',
                                    alignItems: 'center',
                                    padding: '15px',
                                    background: idx === 0 
                                      ? 'linear-gradient(135deg, #fef3c7 0%, #fde68a 100%)'
                                      : country === playerCountry ? '#eff6ff' : '#f8fafc',
                                    borderRadius: '8px',
                                    border: idx === 0 ? '2px solid #f59e0b' : 'none',
                                    borderLeft: idx === 0 ? '4px solid #f59e0b' : '4px solid #cbd5e1'
                                  }}>
                                    <div style={{ display: 'flex', alignItems: 'center', gap: '15px' }}>
                                      <div style={{ 
                                        fontSize: '1.5rem', 
                                        fontWeight: 'bold',
                                        color: idx === 0 ? '#92400e' : '#64748b',
                                        minWidth: '40px'
                                      }}>
                                        {idx === 0 ? 'ü•á' : idx === 1 ? 'ü•à' : idx === 2 ? 'ü•â' : `${idx + 1}.`}
                                      </div>
                                      <div>
                                        <div style={{ 
                                          fontWeight: 'bold',
                                          fontSize: '1.1rem',
                                          color: idx === 0 ? '#92400e' : '#1e293b'
                                        }}>
                                          {countries[country]?.name || country}
                                        </div>
                                        {country === playerCountry && (
                                          <div style={{ 
                                            fontSize: '0.875rem', 
                                            color: '#3b82f6',
                                            marginTop: '2px'
                                          }}>
                                            (You)
                                          </div>
                                        )}
                                      </div>
                                    </div>
                                    <div style={{ 
                                      fontWeight: 'bold', 
                                      fontSize: '1.5rem',
                                      color: idx === 0 ? '#92400e' : '#1e293b'
                                    }}>
                                      {score} pts
                                    </div>
                                  </div>
                                ))}
                            </div>
                          </div>

                          {/* Admin can reset */}
                          {userRole === 'superadmin' && (
                            <div style={{ marginTop: '20px', textAlign: 'center' }}>
                              <button
                                onClick={() => {
                                  if (window.confirm('Reset this game? All progress will be lost.')) {
                                    socket.emit('resetRoom', {
                                      roomId: currentRoom.id,
                                      playerId
                                    });
                                  }
                                }}
                                style={{
                                  padding: '15px 30px',
                                  background: '#f59e0b',
                                  color: 'white',
                                  border: 'none',
                                  borderRadius: '8px',
                                  fontSize: '1rem',
                                  fontWeight: 'bold',
                                  cursor: 'pointer'
                                }}
                              >
                                üîÑ Start New Game
                              </button>
                            </div>
                          )}
                        </div>
                      )}

                      {/* UNKNOWN PHASE - Debug Fallback */}
                      {gameState.gamePhase !== 'voting' && 
                       gameState.gamePhase !== 'results' && 
                       gameState.gamePhase !== 'complete' && (
                        <div style={{
                          padding: '40px',
                          background: '#fee2e2',
                          borderRadius: '8px',
                          border: '2px solid #dc2626',
                          textAlign: 'center'
                        }}>
                          <h3 style={{ color: '#991b1b' }}>Unknown Game Phase</h3>
                          <p style={{ color: '#7f1d1d' }}>
                            Game phase: <strong>{gameState.gamePhase}</strong>
                          </p>
                          <p style={{ color: '#7f1d1d', fontSize: '0.875rem', marginTop: '15px' }}>
                            This shouldn't happen. Check browser console for errors.
                          </p>
                        </div>
                      )}
                    </div>
                  ) : (
                    <div>
                    <div style={{ marginBottom: '30px' }}>
                    <h3>Players ({playerList.length}/7)</h3>
                    <div style={{ display: 'grid', gap: '12px', marginTop: '12px' }}>
                      {playerList.map((player) => (
                        <div key={player.id} style={{
                          display: 'flex',
                          justifyContent: 'space-between',
                          padding: '12px',
                          background: player.id === playerId ? '#eff6ff' : player.disconnected ? '#fef3c7' : '#f8fafc',
                          borderRadius: '8px',
                          borderLeft: '4px solid ' + (player.id === playerId ? '#3b82f6' : player.disconnected ? '#f59e0b' : '#cbd5e1'),
                          opacity: player.disconnected ? 0.7 : 1
                        }}>
                          <div>
                            <span style={{ fontWeight: 'bold' }}>
                              {countries[player.country]?.name || player.country}
                            </span>
                            {player.id === playerId && <span style={{ marginLeft: '8px', fontSize: '0.875rem', color: '#3b82f6' }}>(You)</span>}
                            {player.disconnected && <span style={{ marginLeft: '8px', fontSize: '0.75rem', color: '#d97706' }}>üîå Disconnected</span>}
                          </div>
                          <div>
                            {gameState?.readyPlayers?.includes(player.id) ? (
                              <span style={{ color: '#16a34a', fontWeight: 'bold' }}>‚úì Ready</span>
                            ) : (
                              <span style={{ color: '#64748b' }}>Not Ready</span>
                            )}
                          </div>
                        </div>
                      ))}
                    </div>
                  </div>

                  {userRole === 'superadmin' ? (
                    <div style={{
                      padding: '20px',
                      background: 'linear-gradient(135deg, #fee2e2 0%, #fecaca 100%)',
                      borderRadius: '8px',
                      border: '2px solid #dc2626',
                      textAlign: 'center'
                    }}>
                      <div style={{ fontSize: '2rem', marginBottom: '10px' }}>üëÅÔ∏è</div>
                      <h3 style={{ color: '#7f1d1d', marginBottom: '10px' }}>Observer Mode</h3>
                      <p style={{ color: '#991b1b', margin: 0 }}>
                        You are observing this game as administrator.<br />
                        You cannot select a country or play.
                      </p>
                    </div>
                  ) : !playerCountry ? (
                    <div>
                      <h3>Select Your Country</h3>
                      <div className="country-grid">
                        {availableCountries.map(key => {
                          const country = countries[key];
                          if (!country) return null;
                          return (
                            <div 
                              key={key} 
                              className={`country-card ${country.color}`}
                              onClick={() => handleJoinGame(key)}
                              style={{ cursor: 'pointer' }}
                            >
                              <h3>{country.name}</h3>
                              <p style={{ fontSize: '0.875rem', marginBottom: '12px', opacity: '0.9' }}>
                                {country.economicPosition}
                              </p>
                              <p style={{ fontSize: '0.75rem', opacity: '0.8' }}>
                                {country.role}
                              </p>
                            </div>
                          );
                        })}
                      </div>
                    </div>
                  ) : (
                    <div>
                      <div style={{
                        padding: '16px',
                        background: '#eff6ff',
                        borderRadius: '8px',
                        marginBottom: '20px'
                      }}>
                        <p style={{ fontWeight: 'bold', marginBottom: '8px' }}>
                          You are playing as: {countries[playerCountry]?.name || playerCountry}
                        </p>
                        <p style={{ fontSize: '0.875rem', color: '#64748b' }}>
                          You are committed to this country for the game.
                        </p>
                      </div>

                      <button
                        onClick={handleReady}
                        className="btn-primary"
                        style={{ width: '100%' }}
                      >
                        {isReady ? '‚úì Ready (Click to Unready)' : 'Mark as Ready'}
                      </button>
                    </div>
                  )}
                </div>
                </div>
              </div>
            );
          }

          return null;
        };

        // Create Room Modal Component
        const CreateRoomModal = ({ onClose, onCreate }) => {
          const [roomName, setRoomName] = useState('');

          const handleSubmit = (e) => {
            e.preventDefault();
            if (roomName.trim()) {
              onCreate(roomName.trim());
            }
          };

          return (
            <div className="modal-overlay" onClick={onClose}>
              <div className="modal" onClick={(e) => e.stopPropagation()}>
                <div className="modal-header">Create New Room</div>
                
                <form onSubmit={handleSubmit}>
                  <div className="form-group">
                    <label className="form-label">Room Name</label>
                    <input
                      type="text"
                      className="form-input"
                      value={roomName}
                      onChange={(e) => setRoomName(e.target.value)}
                      placeholder="e.g., Period 3 History Class"
                      required
                      autoFocus
                    />
                  </div>

                  <div className="modal-actions">
                    <button
                      type="button"
                      onClick={onClose}
                      style={{
                        padding: '10px 20px',
                        background: '#e2e8f0',
                        color: '#475569',
                        border: 'none',
                        borderRadius: '6px',
                        cursor: 'pointer'
                      }}
                    >
                      Cancel
                    </button>
                    <button
                      type="submit"
                      className="btn-primary"
                    >
                      Create Room
                    </button>
                  </div>
                </form>
              </div>
            </div>
          );
        };

        // Initialize app when game data is loaded
        function initializeApp() {
          if (gameData) {
            console.log('=== INITIALIZING APP ===');
            console.log('Game data loaded:', {
              countries: Object.keys(gameData.countries || {}).length,
              issues: (gameData.issues || []).length
            });
            
            try {
              console.log('Creating React root...');
              const root = ReactDOM.createRoot(document.getElementById('root'));
              
              console.log('Rendering component...');
              root.render(<BrettonWoodsMultiRoom />);
              
              console.log('‚úì App initialized successfully!');
            } catch (err) {
              console.error('!!! ERROR INITIALIZING APP !!!');
              console.error('Error name:', err.name);
              console.error('Error message:', err.message);
              console.error('Error stack:', err.stack);
              
              document.getElementById('root').innerHTML = `
                <div class="container">
                  <div class="card">
                    <h2 style="color: #dc2626;">‚ùå Initialization Error</h2>
                    <p>Failed to start the application. Check console for details.</p>
                    <pre style="background: #f8fafc; padding: 10px; overflow: auto; text-align: left; font-size: 0.875rem;">
${err.name}: ${err.message}

Stack:
${err.stack}
                    </pre>
                    <button onclick="location.reload()" class="btn-primary" style="margin-top: 20px;">
                      Reload Page
                    </button>
                    <button onclick="console.log('Error details:', ${JSON.stringify(err.message)})" 
                            style="margin-top: 10px; padding: 10px 20px; background: #64748b; color: white; border: none; border-radius: 6px; cursor: pointer;">
                      Show Error in Console
                    </button>
                  </div>
                </div>
              `;
            }
          } else {
            console.error('!!! Cannot initialize - no game data !!!');
            document.getElementById('root').innerHTML = `
              <div class="container">
                <div class="card">
                  <h2 style="color: #dc2626;">‚ùå No Game Data</h2>
                  <p>Game data failed to load. Check console and ensure game-data.json exists.</p>
                  <button onclick="location.reload()" class="btn-primary">
                    Reload Page
                  </button>
                </div>
              </div>
            `;
          }
        }
    </script>
</body>
</html>
