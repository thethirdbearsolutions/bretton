<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bretton Woods - Diagnostics</title>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f8fafc;
        }
        .test {
            background: white;
            padding: 20px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #64748b;
        }
        .test.success {
            border-left-color: #16a34a;
        }
        .test.error {
            border-left-color: #dc2626;
        }
        .test.pending {
            border-left-color: #f59e0b;
        }
        h1 { color: #1e293b; }
        h3 { margin-top: 0; }
        pre {
            background: #f1f5f9;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 0.875rem;
        }
        .status {
            font-weight: bold;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <h1>üîç Bretton Woods Diagnostics</h1>
    <p>Running tests to identify loading issue...</p>

    <div id="test1" class="test pending">
        <h3>1. Socket.IO Connection</h3>
        <div class="status">‚è≥ Testing...</div>
        <pre id="test1-result">Waiting...</pre>
    </div>

    <div id="test2" class="test pending">
        <h3>2. Game Data File (game-data.json)</h3>
        <div class="status">‚è≥ Testing...</div>
        <pre id="test2-result">Waiting...</pre>
    </div>

    <div id="test3" class="test pending">
        <h3>3. Military Data File</h3>
        <div class="status">‚è≥ Testing...</div>
        <pre id="test3-result">Waiting...</pre>
    </div>

    <div id="test4" class="test pending">
        <h3>4. React Libraries</h3>
        <div class="status">‚è≥ Testing...</div>
        <pre id="test4-result">Waiting...</pre>
    </div>

    <div id="test5" class="test pending">
        <h3>5. Server Response</h3>
        <div class="status">‚è≥ Testing...</div>
        <pre id="test5-result">Waiting...</pre>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

    <script>
        // Test 1: Socket.IO
        (function() {
            const testDiv = document.getElementById('test1');
            const resultPre = document.getElementById('test1-result');
            
            try {
                const socket = io();
                
                socket.on('connect', () => {
                    testDiv.className = 'test success';
                    testDiv.querySelector('.status').innerHTML = '‚úÖ Success';
                    resultPre.textContent = 'Socket.IO connected successfully!\nSocket ID: ' + socket.id;
                });

                socket.on('connect_error', (error) => {
                    testDiv.className = 'test error';
                    testDiv.querySelector('.status').innerHTML = '‚ùå Failed';
                    resultPre.textContent = 'Socket.IO connection failed:\n' + error.message;
                });

                setTimeout(() => {
                    if (!socket.connected) {
                        testDiv.className = 'test error';
                        testDiv.querySelector('.status').innerHTML = '‚ùå Timeout';
                        resultPre.textContent = 'Socket.IO connection timed out after 5 seconds';
                    }
                }, 5000);
            } catch (err) {
                testDiv.className = 'test error';
                testDiv.querySelector('.status').innerHTML = '‚ùå Error';
                resultPre.textContent = 'Error loading Socket.IO:\n' + err.message;
            }
        })();

        // Test 2: Game Data
        (function() {
            const testDiv = document.getElementById('test2');
            const resultPre = document.getElementById('test2-result');
            
            fetch('/game-data.json')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('HTTP ' + response.status + ': ' + response.statusText);
                    }
                    return response.json();
                })
                .then(data => {
                    testDiv.className = 'test success';
                    testDiv.querySelector('.status').innerHTML = '‚úÖ Success';
                    resultPre.textContent = 
                        'game-data.json loaded successfully!\n' +
                        'Countries: ' + Object.keys(data.countries || {}).length + '\n' +
                        'Issues: ' + (data.issues || []).length + '\n' +
                        'File size: ~' + JSON.stringify(data).length + ' bytes';
                })
                .catch(err => {
                    testDiv.className = 'test error';
                    testDiv.querySelector('.status').innerHTML = '‚ùå Failed';
                    resultPre.textContent = 'Failed to load game-data.json:\n' + err.message + '\n\nThis is the most likely cause of the freeze!';
                });
        })();

        // Test 3: Military Data
        (function() {
            const testDiv = document.getElementById('test3');
            const resultPre = document.getElementById('test3-result');
            
            fetch('/military-deployments.json')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('HTTP ' + response.status + ': ' + response.statusText);
                    }
                    return response.json();
                })
                .then(data => {
                    testDiv.className = 'test success';
                    testDiv.querySelector('.status').innerHTML = '‚úÖ Success';
                    resultPre.textContent = 'military-deployments.json loaded successfully!';
                })
                .catch(err => {
                    testDiv.className = 'test error';
                    testDiv.querySelector('.status').innerHTML = '‚ùå Failed';
                    resultPre.textContent = 'Failed to load military-deployments.json:\n' + err.message;
                });
        })();

        // Test 4: React
        (function() {
            const testDiv = document.getElementById('test4');
            const resultPre = document.getElementById('test4-result');
            
            setTimeout(() => {
                try {
                    if (typeof React === 'undefined') {
                        throw new Error('React is not loaded');
                    }
                    if (typeof ReactDOM === 'undefined') {
                        throw new Error('ReactDOM is not loaded');
                    }
                    
                    testDiv.className = 'test success';
                    testDiv.querySelector('.status').innerHTML = '‚úÖ Success';
                    resultPre.textContent = 
                        'React loaded: ' + React.version + '\n' +
                        'ReactDOM loaded: Yes';
                } catch (err) {
                    testDiv.className = 'test error';
                    testDiv.querySelector('.status').innerHTML = '‚ùå Failed';
                    resultPre.textContent = 'React libraries not loaded:\n' + err.message;
                }
            }, 2000);
        })();

        // Test 5: Server Info
        (function() {
            const testDiv = document.getElementById('test5');
            const resultPre = document.getElementById('test5-result');
            
            fetch('/')
                .then(response => response.text())
                .then(html => {
                    testDiv.className = 'test success';
                    testDiv.querySelector('.status').innerHTML = '‚úÖ Success';
                    
                    // Check which HTML file is being served
                    if (html.includes('Multi-Room')) {
                        resultPre.textContent = 'Server is serving: index-multiroom.html ‚úì\nMulti-room mode is active';
                    } else if (html.includes('Multiplayer')) {
                        resultPre.textContent = 'Server is serving: index.html (SINGLE-ROOM)\n‚ö†Ô∏è  Server is NOT using multi-room!';
                        testDiv.className = 'test error';
                        testDiv.querySelector('.status').innerHTML = '‚ö†Ô∏è  Wrong File';
                    } else {
                        resultPre.textContent = 'Server response received\nHTML length: ' + html.length + ' bytes';
                    }
                })
                .catch(err => {
                    testDiv.className = 'test error';
                    testDiv.querySelector('.status').innerHTML = '‚ùå Failed';
                    resultPre.textContent = 'Server request failed:\n' + err.message;
                });
        })();

        // Overall summary after all tests
        setTimeout(() => {
            document.body.innerHTML += `
                <div style="background: #1e293b; color: white; padding: 20px; border-radius: 8px; margin-top: 30px;">
                    <h2>üí° What to do next:</h2>
                    <ol>
                        <li>Check all tests above - any ‚ùå indicates a problem</li>
                        <li>Most common issue: game-data.json not found (Test 2)</li>
                        <li>If Test 5 shows "SINGLE-ROOM", server is not using multi-room files</li>
                        <li>Open browser console (F12) for more details</li>
                        <li>Share these results if you need help debugging</li>
                    </ol>
                    <p><strong>Next:</strong> Go to <a href="/" style="color: #60a5fa;">main page</a> or <a href="/index-multiroom.html" style="color: #60a5fa;">multi-room directly</a></p>
                </div>
            `;
        }, 6000);
    </script>
</body>
</html>
